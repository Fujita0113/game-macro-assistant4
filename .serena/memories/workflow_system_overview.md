# ワークフローシステム概要

## AI開発ワークフロー（5フェーズ）

### フェーズ1: 要件取得・計画立案
1. **要件定義書取得**: ユーザーから固まった要件定義を受領
2. **進捗状態確認**: `.claude/progress.json`読み込み、中断箇所特定
3. **要件分析**: Intake-Agentが要件を構造化・分析
4. **技術仕様作成**: DocGen-Agentがclaude.md更新・技術要件定義
5. **開発計画立案**: Planner-Agentが依存関係分析し実行可能タスク抽出

### フェーズ2: タスク管理・配備
6. **タスク仕様作成**: TaskGen-Agentが実装手順・背景・テスト要件を含む詳細仕様生成
7. **開発環境配備**: Dispatcher-Agentがworktree作成・Dev-Agent割り当て

### フェーズ3: 並行開発・品質保証
8. **並行実装**: 複数Dev-Agentが独立してworktree内で開発・テスト実行（最大2同時）
9. **コードレビュー**: Review-Agentが実装品質・設計適合性検証・修正指示
10. **ユーザーテスト準備**: TestDoc-Agentがテスト手順書・worktree情報含むMD作成

### フェーズ4: ユーザー検証・統合
11. **ユーザーテスト**: ユーザーによる機能検証・バグ報告受付
12. **バグ修正サイクル**: BugFix-Agentがログ分析→問題特定→修正実装反復
13. **統合準備**: 全テスト完了後、main→taskブランチプル・結合テスト実行
14. **本統合**: Integrator-Agentがtask→mainマージ・統合検証

### フェーズ5: 次サイクル移行
15. **進捗更新**: メインエージェントが完了タスクをprogress.jsonに記録
16. **次回計画**: 新たに実行可能になったタスクでフェーズ1に戻る

## メインエージェント権限（権限中央集権化）

### 必須実行ルール
1. **セッション開始時**: `python src/WorkflowStateMachine.py` → 中断復帰・フェーズ判定
2. **進捗報告時**: `python src/ProgressVisualizer.py` → ダッシュボード表示
3. **完了シグナル検知時**: 証跡検証 → 適切エージェント自動起動
4. **progress.json更新**: メインエージェントの唯一権限

### データ更新責任
- **メインエージェント**: progress.json更新の唯一権限者
- **Dev-Agent**: 完了シグナル送信のみ → メインが状態更新
- **Review-Agent**: 承認/却下シグナル送信のみ
- **全サブエージェント**: 直接progress.json更新禁止

## 完了シグナル形式（証跡義務化）
新形式必須: `##SIGNAL_TYPE##|evidence:{"key":"value",...}`
旧形式自動拒否: `##DEV_DONE##` (証跡なし)