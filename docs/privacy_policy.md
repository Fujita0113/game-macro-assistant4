# プライバシーポリシー

## クラッシュダンプの収集と送信について (R-019)

### データ収集の目的
GameMacroAssistant は、ソフトウェアの品質向上とバグ修正のため、アプリケーションがクラッシュした際の診断情報を収集します。

### 収集されるデータ

#### クラッシュダンプファイル
- **保存場所**: `%LOCALAPPDATA%\GameMacroAssistant\CrashDumps\`
- **ファイル形式**: .dmp (Windows ミニダンプ)
- **含まれる情報**:
  - スタックトレース
  - 実行時のメモリ状態
  - レジスタ情報
  - 読み込まれたモジュール一覧
  - システム情報（OS バージョン、CPU アーキテクチャ等）

#### 含まれない情報
- **個人ファイル**: マクロファイル (.gma.json) の内容
- **パスフレーズ**: 暗号化に使用したパスワード
- **入力履歴**: キーボード・マウス操作の詳細
- **スクリーンショット**: 画面キャプチャデータ
- **ブラウザデータ**: Cookie、履歴、保存されたパスワード

### ユーザー同意プロセス

#### 初回クラッシュ時
アプリケーションがクラッシュした際、以下のダイアログが表示されます：

```
┌─────────────────────────────────────────┐
│ GameMacroAssistant - クラッシュレポート │
├─────────────────────────────────────────┤
│                                         │
│ アプリケーションが予期せず終了しました。│
│                                         │
│ 品質向上のため、クラッシュ情報を開発者  │
│ に送信してもよろしいですか？            │
│                                         │
│ ☐ 今後も自動的に送信する                │
│                                         │
│ [詳細を表示] [送信する] [送信しない]    │
└─────────────────────────────────────────┘
```

#### 詳細情報の表示
「詳細を表示」をクリックすると、送信される情報の概要が表示されます：

- クラッシュ発生時刻
- エラーコードと簡易説明
- 送信先URL（下記参照）
- 含まれるデータと除外されるデータの詳細

#### 設定の変更
送信設定は、アプリケーション設定画面でいつでも変更可能です：

```
[設定] > [プライバシー] > [クラッシュレポート]
・[✓] クラッシュ情報を自動送信する
・[詳細設定] > 送信前に確認ダイアログを表示
```

### データの送信と処理

#### 送信先
- **送信先URL**: https://crashreport.gamemacroassistant.dev/api/v1/reports
- **通信方式**: HTTPS (TLS 1.3)
- **認証**: 送信時に一意のセッションIDを生成（個人識別不可）

#### 送信されるデータ形式
```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "sessionId": "uuid-v4-random",
  "applicationVersion": "1.0.0",
  "osVersion": "Windows 11 22H2",
  "crashType": "AccessViolationException",
  "dumpFileHash": "sha256-hash",
  "dumpFile": "base64-encoded-dump"
}
```

#### データの利用方法
1. **バグ分析**: クラッシュの根本原因特定
2. **品質改善**: 安定性向上のための修正
3. **統計情報**: クラッシュ頻度とパターンの分析
4. **サポート**: ユーザーサポート時の参考情報

#### データの保護
- **暗号化**: 送信時および保存時に暗号化
- **アクセス制限**: 開発チームの認証されたメンバーのみアクセス可能
- **自動削除**: 90日経過後に自動削除
- **監査ログ**: アクセス記録の維持

### 個人情報の保護

#### 個人情報の定義
本アプリケーションにおいて「個人情報」とは、以下を指します：
- マクロファイルの内容
- スクリーンショット画像
- 入力操作履歴
- ファイルパス（ユーザー名を含む）

#### 除外処理
クラッシュダンプからは、以下の処理により個人情報を除外します：

```csharp
// ダンプファイル生成時のフィルタリング
public void CreateFilteredDump(IntPtr processHandle, uint processId)
{
    var dumpType = MiniDumpType.MiniDumpNormal 
                 | MiniDumpType.MiniDumpWithDataSegs
                 | MiniDumpType.MiniDumpWithHandleData
                 // ユーザーデータを含む可能性のあるヒープ情報は除外
                 & ~MiniDumpType.MiniDumpWithFullMemory
                 & ~MiniDumpType.MiniDumpWithPrivateReadWriteMemory;
    
    MiniDumpWriteDump(processHandle, processId, dumpFile, dumpType, 
                      ref exceptionInfo, IntPtr.Zero, IntPtr.Zero);
}
```

### ユーザーの権利

#### アクセス権
- 送信されたクラッシュレポートの詳細確認
- 送信履歴の確認（アプリケーション内）

#### 削除権
- ローカルクラッシュダンプファイルの手動削除
- 送信済みデータの削除要請（下記連絡先まで）

#### 設定変更権
- 送信設定の有効/無効切り替え
- 送信前確認ダイアログの表示/非表示

### データ送信の停止方法

#### アプリケーション設定
```
[設定] > [プライバシー] > [クラッシュレポート] > [無効にする]
```

#### レジストリによる一括無効化
```reg
Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Software\GameMacroAssistant\Privacy]
"CrashReportEnabled"=dword:00000000
"ShowConfirmDialog"=dword:00000001
```

#### ローカルダンプファイルの削除
```batch
@echo off
echo クラッシュダンプファイルを削除しています...
del /q "%LOCALAPPDATA%\GameMacroAssistant\CrashDumps\*.*"
echo 削除が完了しました。
```

### 法的基盤

#### 適用法令
- **個人情報保護法** (日本)
- **GDPR** (EU一般データ保護規則) - EU圏ユーザー
- **CCPA** (カリフォルニア州消費者プライバシー法) - カリフォルニア州ユーザー

#### データ処理の法的根拠
- **正当な利益**: ソフトウェア品質向上
- **ユーザー同意**: 明示的な送信同意

### 連絡先

#### データ保護に関するお問い合わせ
- **メール**: privacy@gamemacroassistant.dev
- **件名**: [プライバシー] クラッシュレポートに関する問い合わせ

#### 削除要請
- **メール**: privacy@gamemacroassistant.dev
- **件名**: [削除要請] クラッシュレポートデータの削除
- **必要情報**: 
  - 削除対象期間
  - セッションID（分かる場合）
  - 削除理由

#### 回答期限
- **通常**: 7営業日以内
- **緊急**: 48時間以内（セキュリティ関連）

### ポリシーの更新

#### 変更通知
本ポリシーに重要な変更がある場合、以下の方法で通知します：
1. アプリケーション起動時の通知
2. 公式ウェブサイトでの公開
3. メール通知（登録ユーザーのみ）

#### 発効日
- **初版**: 2024年1月15日
- **最終更新**: 2024年1月15日
- **次回見直し予定**: 2024年7月15日

---

*このプライバシーポリシーは、GameMacroAssistant v1.0 以降に適用されます。*