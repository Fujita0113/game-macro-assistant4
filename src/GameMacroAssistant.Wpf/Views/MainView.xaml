<Window x:Class="GameMacroAssistant.Wpf.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="GameMacroAssistant" 
        Height="600" 
        Width="800"
        MinHeight="400" 
        MinWidth="600"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- ツールバー -->
        <ToolBar Grid.Row="0" ToolBarTray.IsLocked="True">
            <!-- マクロ記録開始ボタン (R-001) -->
            <Button Name="StartRecordingButton" 
                    Command="{Binding StartRecordingCommand}"
                    Content="{Binding RecordingButtonText}"
                    AutomationProperties.Name="マクロ記録開始"
                    AutomationProperties.HelpText="クリックしてマクロの記録を開始します">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                        <Setter Property="Background" Value="LightGreen"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                <Setter Property="Background" Value="LightCoral"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            
            <Separator/>
            
            <!-- ファイル操作ボタン -->
            <Button Command="{Binding OpenMacroCommand}" Content="開く" 
                    AutomationProperties.Name="マクロファイルを開く"/>
            <Button Command="{Binding SaveMacroCommand}" Content="保存" 
                    AutomationProperties.Name="マクロファイルを保存"/>
            
            <Separator/>
            
            <!-- 実行ボタン -->
            <Button Command="{Binding PlayMacroCommand}" Content="実行" 
                    AutomationProperties.Name="マクロを実行"/>
            <Button Command="{Binding StopMacroCommand}" Content="停止" 
                    AutomationProperties.Name="マクロ実行を停止"/>
        </ToolBar>
        
        <!-- メイン作業エリア -->
        <TabControl Grid.Row="1" Margin="5">
            <!-- 記録・編集タブ -->
            <TabItem Header="マクロ編集" AutomationProperties.Name="マクロ編集タブ">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="300"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- ステップリスト (R-007: ビジュアルエディタ) -->
                    <GroupBox Grid.Column="0" Header="マクロステップ">
                        <ListBox ItemsSource="{Binding MacroSteps}" 
                                 SelectedItem="{Binding SelectedStep}"
                                 AllowDrop="True"
                                 AutomationProperties.Name="マクロステップリスト"
                                 AutomationProperties.HelpText="マクロの実行ステップが表示されます。ドラッグして順序を変更できます">
                            <!-- TODO: ドラッグ&ドロップによる順序変更 (R-010) -->
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="5">
                                        <TextBlock Text="{Binding Type}" Width="80" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding Description}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </GroupBox>
                    
                    <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch"/>
                    
                    <!-- プロパティパネル -->
                    <GroupBox Grid.Column="2" Header="プロパティ">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- TODO: 選択されたステップのプロパティ編集 (R-011) -->
                                <TextBlock Text="ステップの詳細設定" FontWeight="Bold"/>
                                <TextBlock Text="{Binding SelectedStep.Type, StringFormat='種別: {0}'}" />
                                <TextBlock Text="{Binding SelectedStep.Timestamp, StringFormat='時刻: {0:HH:mm:ss.fff}'}" />
                            </StackPanel>
                        </ScrollViewer>
                    </GroupBox>
                </Grid>
            </TabItem>
            
            <!-- 設定タブ -->
            <TabItem Header="設定" AutomationProperties.Name="設定タブ">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <!-- 記録設定 -->
                        <GroupBox Header="記録設定" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <!-- 記録停止キー設定 (R-005) -->
                                <TextBlock Text="記録停止キー:"/>
                                <ComboBox SelectedValue="{Binding StopRecordingKey}" 
                                         AutomationProperties.Name="記録停止キー選択">
                                    <!-- TODO: キー選択肢の実装 -->
                                </ComboBox>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- 画像マッチング設定 (R-013) -->
                        <GroupBox Header="画像マッチング設定" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock Text="SSIM閾値:"/>
                                <Slider Value="{Binding SsimThreshold}" 
                                       Minimum="0.5" Maximum="1.0" 
                                       TickFrequency="0.05" IsSnapToTickEnabled="True"
                                       AutomationProperties.Name="SSIM閾値スライダー"/>
                                <TextBlock Text="{Binding SsimThreshold, StringFormat='値: {0:F2}'}"/>
                                
                                <TextBlock Text="ピクセル差分閾値 (%):" Margin="0,10,0,0"/>
                                <Slider Value="{Binding PixelDifferenceThreshold}" 
                                       Minimum="0" Maximum="0.1" 
                                       TickFrequency="0.01" IsSnapToTickEnabled="True"
                                       AutomationProperties.Name="ピクセル差分閾値スライダー"/>
                                <TextBlock Text="{Binding PixelDifferenceThreshold, StringFormat='値: {0:P1}'}"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- ステータスバー -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <!-- パフォーマンス表示 (R-020) -->
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="CPU:"/>
                    <TextBlock Text="{Binding CpuUsage, StringFormat=N1}" Margin="5,0"/>
                    <TextBlock Text="RAM:"/>
                    <TextBlock Text="{Binding MemoryUsage, StringFormat=F0}" Margin="5,0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>